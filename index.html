<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T-S Diagram Tool - Advanced Version</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="notification-container"></div>
    <div class="container">
        <div class="header"><h1>üå°Ô∏è T-S Diagram</h1><p>Universal Point Input | XSteam Integration | Advanced Tools</p></div>
        <div class="main-content" id="main-content">
            <div class="sidebar">
                
                <div class="section">
                    <div class="section-title" onclick="toggleSection(this)"><span>‚ûï Add Points & Data</span><span class="toggle-icon">‚ñæ</span></div>
                    <div class="section-content">
                        <!-- Sekme Deƒüi≈ütirici Butonlar -->
                        <div class="tab-switcher">
                            <button class="tab-btn active" id="tab-btn-bulk" onclick="switchTab('bulk')">Bulk Import / Update</button>
                            <button class="tab-btn" id="tab-btn-single" onclick="switchTab('single')">Single Point</button>
                        </div>

                        <!-- Toplu Veri Giri≈üi Sekmesi ƒ∞√ßeriƒüi -->
                        <div class="tab-content active" id="tab-content-bulk">
                            <!-- DEƒûƒ∞≈ûƒ∞KLƒ∞K: Placeholder'daki 'S' harfi 's' yapƒ±ldƒ± -->
                            <h4>1. Points (T,s)</h4>
                            <textarea id="tableInput" placeholder="Point   T   s&#10;1   100 2&#10;2   200 3"></textarea>
                            <div class="operations-grid" style="margin-top: 8px; margin-bottom:15px;">
                                <button class="btn" style="background:#6c757d; color:white;" onclick="document.getElementById('tableInput').value = ''">Clear Text</button>
                                <!-- DEƒûƒ∞≈ûƒ∞KLƒ∞K: Buton metnindeki 'S' harfi 's' yapƒ±ldƒ± -->
                                <button class="btn btn-primary" onclick="importPoints()">Apply T-s Data</button>
                            </div>
                            
							<h4>2. XSteam (P,h)</h4>
							<textarea id="ph_table_input" rows="5" placeholder="Point   P(kPa)   h(kJ/kg)&#10;1   100   hf&#10;2   100   hg"></textarea>

							<!-- DEƒûƒ∞≈ûƒ∞KLƒ∞K: Yeni buton eklendi ve grid yapƒ±sƒ± g√ºncellendi -->
							<div class="operations-grid three-columns" style="margin-top: 8px; margin-bottom:15px;">
								<button class="btn" style="background:#6c757d; color:white;" onclick="document.getElementById('ph_table_input').value = ''">Clear Text</button>
								<button class="btn" style="background:#6c757d; color:white;" onclick="loadPhToEditor()">Load Current</button>
								<button class="btn btn-primary" onclick="importAndCalculate_PH_Data()">Apply P-h Data</button>
							</div>

							<div id="batchSpinner" class="spinner"></div>
                        </div>

                        <!-- Tek Nokta Ekleme Sekmesi ƒ∞√ßeriƒüi -->
                        <div class="tab-content" id="tab-content-single">
                            <div class="method-switcher">
                                <button id="switchToXsteamBtn" class="method-btn active" onclick="switchInputMethod('xsteam')">Calculate (XSteam)</button>
                                <!-- DEƒûƒ∞≈ûƒ∞KLƒ∞K: Buton metnindeki 'S' harfi 's' yapƒ±ldƒ± -->
                                <button id="switchToDirectBtn" class="method-btn" onclick="switchInputMethod('direct')">Direct (T, s)</button>
                            </div>
                            <div class="input-group">
                                <label>Point Name:</label>
                                <input type="text" id="pointName" value="1">
                            </div>
                            <div id="xsteamInputArea" class="method-content active">
                                <p id="method-description"></p>
                                <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:10px;">
                                    <div class="input-group"><label for="prop1_type">Known Property 1</label><select id="prop1_type"></select></div>
                                    <div class="input-group"><label for="prop2_type">Known Property 2</label><select id="prop2_type"></select></div>
                                </div>
                                <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                                    <div class="input-group">
                                        <label id="prop1_label" for="prop1_value">Pressure (kPa)</label>
                                        <div class="input-hint" id="prop1_hint"></div>
                                        <input type="text" id="prop1_value" placeholder="e.g., 101.3" onfocus="showValueSuggestions(this, document.getElementById('prop1_type').value, 'xsteam'); showHint('prop1')" onblur="hideHint('prop1')" oninput="showHint('prop1')">
                                    </div>
                                    <div class="input-group">
                                        <label id="prop2_label" for="prop2_value">Enthalpy (kJ/kg)</label>
                                        <div class="input-hint" id="prop2_hint"></div>
                                        <input type="text" id="prop2_value" placeholder="e.g., 2500" onfocus="showValueSuggestions(this, document.getElementById('prop2_type').value, 'xsteam'); showHint('prop2')" onblur="hideHint('prop2')" oninput="showHint('prop2')">
                                    </div>
                                </div>
                                <button id="addSinglePointBtn" class="btn btn-primary" onclick="addSinglePointUnified()">üßÆ Calculate & Add Point</button>
                                <div id="singlePointSpinner" class="spinner"></div>
                                <div id="value-suggestion-section-xsteam" class="section collapsed" style="margin-top: 20px; box-shadow: 0 4px 12px rgba(42,82,152,0.15);">
                                    <div class="section-title" onclick="toggleSection(this)"><span id="suggestion-title-xsteam">Existing Values</span><span class="toggle-icon">‚ñæ</span></div>
                                    <div class="section-content">
                                        <div class="suggestion-switcher"><button class="suggestion-btn active" onclick="switchSuggestionMode('value', 'xsteam')">By Value</button><button class="suggestion-btn" onclick="switchSuggestionMode('point', 'xsteam')">By Point</button></div>
                                        <div id="suggestion-content-value-xsteam" class="suggestion-content active"><div id="suggestion-buttons-value-xsteam" class="values-container"></div></div>
                                        <div id="suggestion-content-point-xsteam" class="suggestion-content"><div id="suggestion-buttons-point-xsteam" class="values-container"></div></div>
                                    </div>
                                </div>
                            </div>
                            <div id="directInputArea" class="method-content">
                                <p id="method-description-direct"></p>
                                <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                                    <!-- DEƒûƒ∞≈ûƒ∞KLƒ∞K: 'directS' -> 'directs' ve 'S' -> 's' -->
                                    <div class="input-group"><label for="directT">Temperature (¬∞C)</label><input type="number" id="directT" placeholder="e.g., 100" onfocus="showValueSuggestions(this, 'T', 'direct')"></div>
                                    <div class="input-group"><label for="directs">Entropy (kJ/kg¬∑K)</label><input type="number" id="directs" placeholder="e.g., 6.5" onfocus="showValueSuggestions(this, 's', 'direct')"></div>
                                </div>
                                <!-- DEƒûƒ∞≈ûƒ∞KLƒ∞K: Buton metnindeki 'S' harfi 's' yapƒ±ldƒ± -->
                                <button id="addDirectPointBtn" class="btn btn-primary" onclick="addDirectPoint()">üìç Add T-s Point</button>
                                <div id="value-suggestion-section-direct" class="section collapsed" style="margin-top: 20px; box-shadow: 0 4px 12px rgba(42,82,152,0.15);">
                                    <div class="section-title" onclick="toggleSection(this)"><span id="suggestion-title-direct">Existing Values</span><span class="toggle-icon">‚ñæ</span></div>
                                    <div class="section-content">
                                        <div class="suggestion-switcher"><button class="suggestion-btn active" onclick="switchSuggestionMode('value', 'direct')">By Value</button><button class="suggestion-btn" onclick="switchSuggestionMode('point', 'direct')">By Point</button></div>
                                        <div id="suggestion-content-value-direct" class="suggestion-content active"><div id="suggestion-buttons-value-direct" class="values-container"></div></div>
                                        <div id="suggestion-content-point-direct" class="suggestion-content"><div id="suggestion-buttons-point-direct" class="values-container"></div></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ... Diƒüer b√∂l√ºmler aynƒ± kalƒ±r ... -->
				<div class="section">
                    <div class="section-title" onclick="toggleSection(this)">
                        <span>üîó Bulk Connection Editor</span>
                        <!-- DEƒûƒ∞≈ûƒ∞KLƒ∞K: Kullanƒ±m kƒ±lavuzunu g√∂steren yardƒ±m simgesi eklendi -->
                        <span class="help-icon" onclick="showBulkEditorHelp(event)">‚ìò</span>
                        <span class="toggle-icon">‚ñæ</span>
                    </div>
                    <div class="section-content">
                        <textarea id="bulkConnectionsEditor" rows="6" placeholder="Source,Target,&quot;Label&quot;,Color,Style,Width&#10;1,2,&quot;Work&quot;,blue,dashed,3&#10;3(p=1000,x=0),4(p=10,s=*3)"></textarea>
                        <div class="operations-grid" style="margin-top: 8px;">
                            <button class="btn" style="background:#6c757d; color:white;" onclick="loadConnectionsToEditor()">‚§ì Load Current</button>
                            <button class="btn" style="background:#28a745; color:white;" onclick="applyBulkConnections()">‚Ü• Apply Changes</button>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-title" onclick="toggleSection(this)"><span>„Ä∞Ô∏è Plot Iso-Lines</span><span class="toggle-icon">‚ñæ</span></div>
                    <div class="section-content">
                        <h4>Plot Constant Pressure Line (Isobar)</h4>
                        <div class="input-group">
                            <label>Pressure (kPa):</label>
                            <input type="number" id="isobarValue" placeholder="e.g., 1000" onfocus="showValueSuggestions(this, 'P', 'isoline')">
                        </div>
                        <div id="value-suggestion-section-isoline" class="section collapsed" style="margin-top: 20px; box-shadow: 0 4px 12px rgba(42,82,152,0.15);">
                            <div class="section-title" onclick="toggleSection(this)"><span id="suggestion-title-isoline">Existing Values</span><span class="toggle-icon">‚ñæ</span></div>
                            <div class="section-content">
                                <div class="suggestion-switcher"><button class="suggestion-btn active" onclick="switchSuggestionMode('value', 'isoline')">By Value</button><button class="suggestion-btn" onclick="switchSuggestionMode('point', 'isoline')">By Point</button></div>
                                <div id="suggestion-content-value-isoline" class="suggestion-content active"><div id="suggestion-buttons-value-isoline" class="values-container"></div></div>
                                <div id="suggestion-content-point-isoline" class="suggestion-content"><div id="suggestion-buttons-point-isoline" class="values-container"></div></div>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="plotIsoLine()">Plot Isobar</button>
                        <button class="btn" style="background:#17a2b8; color:white; margin-left:5px;" onclick="plotAllPressures()" title="Plot isobars for all point pressures">Plot All Point Pressures</button>
                        <div id="isolineSpinner" class="spinner"></div>
                        <div id="isoLinesList" style="margin-top: 15px;"></div>
                    </div>
                </div>

				<!-- ESKƒ∞ ANALƒ∞Z B√ñL√úM√úN√ú Sƒ∞Lƒ∞P BUNU YAPI≈ûTIRIN -->
				<!-- index.html dosyanƒ±zdaki mevcut cycle-analysis-section div'ini bununla deƒüi≈ütirin -->
				<div class="section" id="cycle-analysis-section"> <!-- DEƒûƒ∞≈ûƒ∞KLƒ∞K: style="display: none;" kaldƒ±rƒ±ldƒ± -->
					<div class="section-title" onclick="toggleSection(this)"><span>üìä Custom Cycle Efficiency</span><span class="toggle-icon">‚ñæ</span></div>
					<div class="section-content">
						
						<!-- DEƒûƒ∞≈ûƒ∞KLƒ∞K: Yeni bir fieldset ve uyarƒ± mesajƒ± eklendi -->
						<fieldset id="analysis-fieldset">
							<p style="font-size: 0.8em; color: #555; margin-bottom: 15px;"> <!-- DEƒûƒ∞≈ûƒ∞KLƒ∞K BURADA -->
								Define the processes where heat is added (Q_H) and rejected (Q_L) to calculate thermal efficiency.
							</p>

							<div class="analysis-group">
								<div class="analysis-group-header">
									<!-- DEƒûƒ∞≈ûƒ∞KLƒ∞K BURADA -->
									<h4>Heat Input (Q<sub>H</sub>) Processes</h4>
									<button id="add-heat-in-btn" class="btn btn-sm" style="background:#28a745; color:white;" onclick="addProcess('in')">+ Add Boiler/Heater</button>
								</div>
								<div id="heat-in-list" class="process-list"></div>
							</div>

							<div class="analysis-group">
								<div class="analysis-group-header">
									<!-- DEƒûƒ∞≈ûƒ∞KLƒ∞K BURADA -->
									<h4>Heat Rejection (Q<sub>L</sub>) Processes</h4>
									<button id="add-heat-out-btn" class="btn btn-sm" style="background:#6c757d; color:white;" onclick="addProcess('out')">+ Add Condenser/Cooler</button>
								</div>
								<div id="heat-out-list" class="process-list"></div>
							</div>							
							<button id="calculate-efficiency-btn" class="btn btn-primary" style="margin-top: 15px;" onclick="calculateCustomEfficiency()">üßÆ Calculate Efficiency</button>
						</fieldset>
						
						<!-- DEƒûƒ∞≈ûƒ∞KLƒ∞K: Yeterli nokta olmadƒ±ƒüƒ±nda g√∂sterilecek uyarƒ± -->
						<p id="analysis-warning" style="font-size: 0.9em; color: #6c757d; text-align: center; padding: 20px; border: 1px dashed #ced4da; border-radius: 6px;"></p>

						<div id="analysisSpinner" class="spinner"></div>
						<div id="analysis-results-container" style="margin-top: 15px;"></div>
					</div>
				</div>

                <div class="section" id="points-section">
                    <div class="section-title" onclick="toggleSection(this)"><span>üìã Points</span><span class="toggle-icon">‚ñæ</span></div>
                    <div class="section-content"><div id="pointsList" class="points-list"></div></div>
                </div>
                
                <div class="section">
                    <div class="section-title" onclick="toggleSection(this)"><span>‚öôÔ∏è Operations</span><span class="toggle-icon">‚ñæ</span></div>
                    <div class="section-content">
						<!-- index.html dosyanƒ±zdaki operations-grid div'ini bununla deƒüi≈ütirin -->
						<div class="operations-grid">
							<button id="undoBtn" class="btn" style="background:#ffc107; color:#333;" onclick="undo()">‚Ü∂ Undo</button>
							<button id="redoBtn" class="btn" style="background:#ffc107; color:#333;" onclick="redo()">‚Ü∑ Redo</button>
							<button class="btn" style="background:#17a2b8; color:white; grid-column: span 2;" onclick="autoScaleAxes()">‚¨ô Auto-Scale</button>
							
							<!-- DEƒûƒ∞≈ûƒ∞KLƒ∞K: Yeni "Clear Drawing" butonu eklendi -->
							<button class="btn btn-clear-drawing" onclick="clearDrawing()">
								<span class="btn-icon">‚úèÔ∏è</span> Clear Drawing
							</button>
							
							<!-- DEƒûƒ∞≈ûƒ∞KLƒ∞K: Mevcut "Clear All" butonu g√ºncellendi -->
							<button class="btn btn-clear-all" onclick="clearAll()">
								<span class="btn-icon">üóëÔ∏è</span> Clear All Project
							</button>
						</div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-title" onclick="toggleSection(this)"><span>üíæ Project & Data Export</span><span class="toggle-icon">‚ñæ</span></div>
                    <div class="section-content">
                        <h4>Project File</h4>
                        <div class="operations-grid">
                            <button class="btn" style="background:#007bff; color:white;" onclick="exportProject()">üì• Save (.json)</button>
                            <button class="btn" style="background:#6c757d; color:white;" onclick="document.getElementById('importFile').click()">üì§ Load (.json)</button>
                            <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importProject(event)">
                        </div>
                        <h4 style="margin-top: 15px;">Data Export</h4>
                        <div class="operations-grid">
                           <button class="btn" style="background:#217346; color:white;" onclick="downloadExcel()">üìä Excel (.xlsx)</button>
                           <button class="btn" style="background:#5a6268; color:white;" onclick="downloadText()">üìã Text (.txt)</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="canvas-area" id="canvas-container">
                 <!-- ... Canvas controls aynƒ± kalƒ±r ... -->
				<div class="controls">
				<div class="checkbox-group"><input type="checkbox" id="showSaturation" checked onchange="draw()"><label for="showSaturation">Saturation Curve</label></div>
				<div class="checkbox-group"><input type="checkbox" id="showLines" checked onchange="draw()"><label for="showLines">Show Lines</label></div>
				<div class="checkbox-group"><input type="checkbox" id="showLabels" checked onchange="draw()"><label for="showLabels">Show Labels</label></div>
				<div class="checkbox-group"><input type="checkbox" id="showArrows" checked onchange="draw()"><label for="showArrows">Show Arrows</label></div>
				<div class="checkbox-group"><input type="checkbox" id="showLegend" checked onchange="updateSettings('showLegend', this.checked)"><label for="showLegend">Show Legend</label></div>
				<div class="checkbox-group"><input type="checkbox" id="allowDragging" checked onchange="updateSettings('isDraggingEnabled', this.checked)"><label for="allowDragging">Allow Dragging</label></div>
				<div class="checkbox-group"><input type="checkbox" id="allowZoom" checked onchange="updateSettings('isZoomEnabled', this.checked)"><label for="allowZoom">Allow Zoom</label></div>
				<div class="checkbox-group"><input type="checkbox" id="allowBending" checked onchange="updateSettings('isBendingEnabled', this.checked)"><label for="allowBending">Allow Bending</label></div>
				<button id="connectModeBtn" class="btn" style="background:#8e44ad; color:white;" onclick="toggleConnectionMode()">üîó Connect</button>
				<button id="finalizeButton" class="btn" style="background:#17a2b8; color:white;" onclick="toggleFinalizeMode()">Presentation</button>
				<button class="btn" style="background:#28a745; color:white;" onclick="downloadImage()">üíæ 4K PNG</button>
				<button class="btn" style="background:#8f5fe8; color:white;" onclick="downloadSVG()">‚ú® SVG</button>
				</div>
                <div id="canvas-wrapper">
                    <canvas id="canvas" tabindex="-1"></canvas>
                    <div id="context-menu">
                        <ul>
                            <li onclick="ctxMenuEdit()">‚úèÔ∏è Edit Details</li>
                            <li onclick="ctxMenuConnect()">üîó Start Connection</li>
                            <li class="separator"></li>
                            <li class="danger" onclick="ctxMenuDelete()">üóëÔ∏è Delete Point</li>
                        </ul>
                    </div>
                    <div id="quick-action-menu">
                        <button onclick="deleteActivePoint()" title="Delete Point">üóëÔ∏è</button>
                    </div>
                    <div id="custom-notes-container">
                        <div class="legend-header" style="padding-bottom: 4px; margin-bottom: 4px;">Notes</div>
                        <textarea id="customNotes" oninput="saveState()"></textarea>
                    </div>
                    <div id="legend-box">
                        <div class="legend-header"></div>
                        <div class="legend-content"></div>
                    </div>
                </div>
            </div>
            <div class="connections-panel">
                <div class="section" id="properties-panel-section">
                    <div class="section-title" onclick="toggleSection(this)">
                        <span id="prop-panel-title">Point Properties</span>
                        <span class="toggle-icon">‚ñæ</span>
                    </div>
                    <div class="section-content">
                        <div id="prop-panel-placeholder" class="prop-panel-placeholder">
                            Select a point to see its properties.
                        </div>
                        <ul id="properties-panel-list" style="display: none;">
                            <li><span class="prop-name">Phase</span><span class="prop-value" id="prop-panel-phase">---</span></li>
                            <li><span class="prop-name">Pressure (P)</span><span class="prop-value" id="prop-panel-P">---</span></li>
                            <li><span class="prop-name">Enthalpy (h)</span><span class="prop-value" id="prop-panel-h">---</span></li>
                            <li><span class="prop-name">Specific Vol. (v)</span><span class="prop-value" id="prop-panel-v">---</span></li>
                            <li><span class="prop-name">Quality (x)</span><span class="prop-value" id="prop-panel-x">---</span></li>
                            <hr style="margin: 8px 0; border: 0; border-top: 1px solid #eee;">
                            <li><span class="prop-name">Actual T (¬∞C)</span><span class="prop-value" id="prop-panel-T">---</span></li>
                            <!-- DEƒûƒ∞≈ûƒ∞KLƒ∞K: Etiket ve ID'deki 'S' harfleri 's' yapƒ±ldƒ± -->
                            <li><span class="prop-name">Actual s (kJ/kg¬∑K)</span><span class="prop-value" id="prop-panel-s">---</span></li>
                            <li class="visual-prop" id="visual-T-row" style="display: none;"><span class="prop-name">Visual T (¬∞C)</span><span class="prop-value" id="prop-panel-visual-T">---</span></li>
                             <!-- DEƒûƒ∞≈ûƒ∞KLƒ∞K: Etiket ve ID'deki 'S' harfleri 's' yapƒ±ldƒ± -->
                            <li class="visual-prop" id="visual-s-row" style="display: none;"><span class="prop-name">Visual s (kJ/kg¬∑K)</span><span class="prop-value" id="prop-panel-visual-s">---</span></li>
                        </ul>
                        
                        <!-- Saturation Properties in Side Panel -->
                        <div id="side-saturation-section" class="saturation-properties-section" style="margin-top: 12px; display: none;">
                            <div class="saturation-header" onclick="toggleSideSaturationProperties()">
                                <span class="saturation-title">üî¨ Saturation Properties</span>
                                <span class="saturation-toggle-icon">‚ñæ</span>
                            </div>
                            <div class="saturation-content">
                                <ul id="side-saturation-list"></ul>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- ... Diƒüer paneller aynƒ± kalƒ±r ... -->
                <div class="section" id="connections-section">
                    <div class="section-title" onclick="toggleSection(this)"><span>üîó Connection Settings</span><span class="toggle-icon">‚ñæ</span></div>
                    <div class="section-content">
                        <h4>Manage Connection</h4>
                        <div class="input-group"><label>Source Point:</label><select id="sourcePoint" onchange="updateConnectionManagerUI()"></select></div>
                        <div class="input-group"><label>Target Point:</label><select id="targetPoint" onchange="updateConnectionManagerUI()"></select></div>
                        <div class="input-group"><label>Line Style:</label>
                            <div class="line-style-selector">
                                <button class="style-btn active" data-style="solid" onclick="selectLineStyle('solid')">‚îÄ‚îÄ‚îÄ Solid</button>
                                <button class="style-btn" data-style="dashed" onclick="selectLineStyle('dashed')">‚îà‚îà‚îà Dashed</button>
                                <button class="style-btn" data-style="dotted" onclick="selectLineStyle('dotted')">¬∑¬∑¬∑ Dotted</button>
                            </div>
                        </div>
                        <div class="input-group"><label>Label (on-line):</label><input id="connLabelInput" type="text" placeholder="e.g., Heat Addition"></div>
                        <div class="input-group"><label>Legend Label:</label><input id="connLegendInput" type="text" placeholder="For legend box"></div>
                        <div class="input-group" style="display:flex;gap:10px;align-items:center;">
                          <input id="connShowLegend" type="checkbox" style="width:auto;"><label for="connShowLegend" style="margin:0;">Show in Legend</label>
                          <input id="connColorInput" type="color" value="#000000" title="Line color" style="margin-left:auto;">
                          <input id="connWidthInput" type="number" min="0.5" max="10" step="0.5" value="2" title="Line width" style="width:90px;">
                        </div>
                        <div class="input-group" style="display:flex;gap:10px;align-items:center; flex-wrap: wrap;">
                          <button class="btn btn-sm" id="swapBtn" onclick="swapEndpoints()">Swap ‚ÜîÔ∏é</button>
                          <!-- --- YENƒ∞ --- -->
                          <button class="btn btn-sm" style="background:#ffc107; color:#333;" onclick="resetSelectedCurve()">Reset Curve</button>
                          <!-- --- --- -->
                          <div class="checkbox-group" title="Creates arrows in both directions (A->B and B->A)">
                            <input type="checkbox" id="bidirectionalChk"><label for="bidirectionalChk">Bidirectional Arrow</label>
                          </div>
                           <button class="btn btn-sm" style="background:#dc3545;color:white; margin-left:auto;" onclick="removeCurrentFromUI()">Remove</button>
                        </div>
                        <button id="connectionManagerBtn" class="btn btn-primary" onclick="applyConnectionFromUI()">‚ûï Add / Update Connection</button>
                        <h4 style="margin-top:20px;">Active Connections</h4>
                        <div id="connectionsList" style="max-height: 250px; overflow-y: auto;"></div>
                    </div>
                </div>
                <div class="section">
                    <div class="section-title" onclick="toggleSection(this)"><span>üé® Appearance Settings</span><span class="toggle-icon">‚ñæ</span></div>
                    <div class="section-content">
                        <h4>Global</h4>
                        <div class="input-group slider"><label for="lineWidth">Line Width:</label><input type="range" id="lineWidth" min="0.5" max="10" value="2" step="0.5" oninput="updateSettings('lineWidth', this.value)"><span id="lineWidthValue">2.0</span></div>
                        <div class="input-group slider"><label for="saturationWidth">Saturation Curve Width:</label><input type="range" id="saturationWidth" min="0.5" max="10" value="3" step="0.5" oninput="updateSettings('saturationWidth', this.value)"><span id="saturationWidthValue">3.0</span></div>
                        <h4>Point Specific</h4>
                        <div class="input-group"><label for="pointAppearanceSelector">Select Point:</label><select id="pointAppearanceSelector" onchange="updatePointAppearanceControls()"></select></div>
                        <div id="point-appearance-controls">
                            <fieldset id="pointAppearanceFieldset" disabled>
                                <div class="input-group color-picker"><label for="pointColor">Point Color:</label><input type="color" id="pointColor" oninput="updatePointProperty('color', this.value)"></div>
                                <div class="input-group color-picker"><label for="pointCustomLabelColor">Label Color:</label><input type="color" id="pointCustomLabelColor" oninput="updatePointProperty('labelColor', this.value)"></div>
                                <div class="input-group slider"><label for="pointSize">Point Size:</label><input type="range" id="pointSize" min="2" max="20" value="6" step="1" oninput="updatePointProperty('size', this.value)"><span id="pointSizeValue">6</span></div>
                            </fieldset>
                        </div>
                        <h4>Legend</h4>
                        <div class="input-group"><label for="legendTitle">Legend Title:</label><input type="text" id="legendTitle" value="Legend" oninput="updateSettings('legendTitle', this.value)"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="editModal" class="modal-backdrop">
        <div class="modal-content">
            <h2 class="modal-title">Edit Point</h2><input type="hidden" id="editPointIndex">
            <div class="input-group"><label>Point Name:</label><input type="text" id="editPointName"></div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;">
                <div class="input-group"><label>Actual T (¬∞C):</label><input type="number" step="0.01" id="editTemp"></div>
                <!-- DEƒûƒ∞≈ûƒ∞KLƒ∞K: Etiketteki 'S' harfi 's' yapƒ±ldƒ± -->
                <div class="input-group"><label>Actual s (kJ/kg¬∑K):</label><input type="number" step="0.0001" id="editEntropy"></div>
            </div>
            <div class="modal-actions">
                <button class="btn" style="background:#6c757d; color:white;" onclick="closeEditModal()">Cancel</button>
                <button class="btn" style="background:#28a745; color:white;" onclick="savePointData()">Save Changes</button>
            </div>
        </div>
    </div>
    <div id="propertiesModal" class="modal-backdrop" onclick="closePropertiesModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h2 class="modal-title" id="propertiesModalTitle">Point Properties</h2>
            <ul id="properties-list"></ul>
            
            <!-- Saturation Properties Collapsible Section -->
            <div id="saturation-section" class="saturation-properties-section" style="margin-top: 15px; display: block !important;">
                <div class="saturation-header" onclick="toggleSaturationProperties()">
                    <span class="saturation-title">üî¨ Saturation Properties</span>
                    <span class="saturation-toggle-icon">‚ñæ</span>
                </div>
                <div class="saturation-content">
                    <ul id="saturation-list">
                        <li style="text-align:center; color:#888; padding:15px;">Loading saturation properties...</li>
                    </ul>
                </div>
            </div>
            
            <div class="modal-actions"><button class="btn" style="background:#6c757d; color:white;" onclick="closePropertiesModal()">Close</button></div>
        </div>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="modal-backdrop" style="display: none;">
        <div class="modal-content help-modal-content" onclick="event.stopPropagation()">
            <div class="help-modal-header">
                <h2 class="modal-title">üìñ Bulk Editor - User Guide</h2>
                <button class="help-close-btn" onclick="closeHelpModal()">‚úï</button>
            </div>
            <div class="help-modal-body" id="helpModalBody">
                <!-- Content will be inserted here -->
            </div>
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="closeHelpModal()">Got it!</button>
            </div>
        </div>
    </div>

    <style>
        .help-modal-content {
            max-width: 900px;
            width: 90%;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
            padding: 0;
        }
        
        .help-modal-header {
            padding: 20px 25px;
            border-bottom: 2px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px 12px 0 0;
        }
        
        .help-modal-header .modal-title {
            margin: 0;
            color: white;
            font-size: 1.5em;
        }
        
        .help-close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 24px;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .help-close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }
        
        .help-modal-body {
            padding: 25px;
            overflow-y: auto;
            flex: 1;
            background: white;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
        }
        
        .help-modal-body::-webkit-scrollbar {
            width: 10px;
        }
        
        .help-modal-body::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 5px;
        }
        
        .help-modal-body::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 5px;
        }
        
        .help-modal-body::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        .help-modal-content .modal-actions {
            padding: 15px 25px;
            border-top: 2px solid #e0e0e0;
            background: #f8f9fa;
            border-radius: 0 0 12px 12px;
        }
        
        .help-section {
            margin-bottom: 30px;
        }
        
        .help-section-title {
            font-size: 16px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 2px solid #667eea;
        }
        
        .help-example {
            background: #f8f9fa;
            padding: 10px 15px;
            border-left: 4px solid #667eea;
            margin: 8px 0;
            border-radius: 4px;
        }
        
        .help-code {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            overflow-x: auto;
        }
        
        .help-tip {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 10px 15px;
            margin: 8px 0;
            border-radius: 4px;
        }
        
        .help-warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 10px 15px;
            margin: 8px 0;
            border-radius: 4px;
        }
        
        .help-error {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            padding: 10px 15px;
            margin: 8px 0;
            border-radius: 4px;
        }
        
        .help-success {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 10px 15px;
            margin: 8px 0;
            border-radius: 4px;
        }
    </style>

    <script src="script.js"></script>
</body>
</html>